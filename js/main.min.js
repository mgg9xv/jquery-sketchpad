var pixelpad=function(){function e(){var e=document.getElementById("paint-color-input").value,t=document.getElementById("paint-opacity-input").value;b.paintRGBA="rgba("+p(e)+","+v(e)+","+E(e)+","+t/100+")",document.getElementById("paint-preview").style.backgroundColor=b.paintRGBA}function t(){document.getElementById("grid-table").innerHTML="";var e=document.getElementById("grid-size-input").value;b.gridSize=e,n(e)}function n(e){for(var t=0;t<e;t++){var n=document.createElement("TR");document.getElementById("grid-table").appendChild(n);for(var a=0;a<e;a++){var d="x"+a+"y"+t,i=document.createElement("TD");i.id=d,i.className="pixel",i.style.backgroundColor="rgba(255,255,255,1)",document.querySelector("tr:last-child").appendChild(i)}}}function a(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=b.gridSize;e.width=n,e.height=n;for(var a=t.getImageData(0,0,n,n),d=a.data,i=0;i<d.length;i+=4){var r=[],o=i/4,c=document.querySelectorAll("tr > td")[o],l=c.style.backgroundColor;l.indexOf("rgba")===-1?(l=l.replace("rgb(",""),l=l.replace(")",""),l=l.replace(/,/g,""),r=l.split(" "),r.push(1)):(l=l.replace("rgba(",""),l=l.replace(")",""),l=l.replace(/,/g,""),r=l.split(" ")),d[i]=parseInt(r[0]),d[i+1]=parseInt(r[1]),d[i+2]=parseInt(r[2]),d[i+3]=255*r[3]}a.data=d,t.putImageData(a,0,0);var u=e.toDataURL();return document.getElementById("preview-image").setAttribute("src",u),u}function d(e){var t=a();e.href=t;var n=document.getElementById("file-name-input").value;e.download=n?n:"favicon.ico"}function i(){var e=document.getElementById("grid-section").clientWidth,t=document.getElementById("grid-section").clientHeight,n=document.getElementById("grid-container");if(t<e){var a=t-.05*t+"px",d=t-.05*t+"px";n.style.height=a,n.style.width=d}else n.style.height=e-.05*e+"px",n.style.width=e-.05*e+"px"}function r(){this===document||"1"===document.getElementById("grid-toggle").value?$("table, th, td ").css("border","1px solid black"):$("table, th, td ").css("border","none")}function o(){if(this===document||b.showFullMenu){var e=document.getElementById("secondary-tools"),t=document.getElementById("masking-layer");b.showFullMenu=!1,l(e,"visible"),l(t,"visible")}else{var e=document.getElementById("secondary-tools"),t=document.getElementById("masking-layer");b.showFullMenu=!0,c(e,"visible"),c(t,"visible")}}function c(e,t){var n=e.className,a=new RegExp("\\b"+t+"\\b");!n.match(a)&&(e.className=n+" "+t)}function l(e,t){var n=e.className,a=new RegExp("\\b"+t+"\\b");n.match(a)&&(e.className=n.replace(a,""))}function u(e){var t=e.srcElement,n=new RegExp("\\bpixel\\b");t.className.match(n)&&(t.style.backgroundColor=b.paintRGBA,b.drawing=!0)}function s(e){var t=e.srcElement,n=new RegExp("\\bpixel\\b");t.className.match(n)&&b.drawing&&(t.style.backgroundColor=b.paintRGBA)}function m(e){var t=document.elementFromPoint(e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY),n=new RegExp("\\bpixel\\b");t.className.match(n)&&b.drawing&&(t.style.backgroundColor=b.paintRGBA)}function g(e){var t=e.srcElement,n=new RegExp("\\bpixel\\b");t.className.match(n)&&(b.drawing=!1,a())}function p(e){return parseInt(y(e).substring(0,2),16)}function v(e){return parseInt(y(e).substring(2,4),16)}function E(e){return parseInt(y(e).substring(4,6),16)}function y(e){return"#"==e.charAt(0)?e.substring(1,7):e}var b={drawing:!1,gridSize:16,paintRGBA:"rgba(0,128,255,0.5)",showFullMenu:!1};n(b.gridSize),i(),e(),window.onresize=i,document.addEventListener("mousedown",u,!1),document.addEventListener("touchstart",u,!1),document.addEventListener("mouseover",s,!1),document.addEventListener("touchmove",m,!1),document.addEventListener("mouseup",g,!1),document.addEventListener("touchend",g,!1),document.getElementById("paint-color-input").addEventListener("change",e),document.getElementById("paint-opacity-input").addEventListener("change",e),document.getElementById("grid-toggle").addEventListener("change",r),document.getElementById("reset-grid-button").addEventListener("click",t),document.getElementById("download-button").addEventListener("click",function(){d(this)}),document.getElementById("full-menu-button").addEventListener("click",o),document.getElementById("masking-layer").addEventListener("click",o)};(document.readyState="complete")?pixelpad():document.addEventListener("DOMContentLoaded",pixelpad);