var pixelpad=function(){function e(){var e=document.getElementById("paint-color-input").value,t=document.getElementById("paint-opacity-input").value;b.paintRGBA="rgba("+p(e)+","+v(e)+","+E(e)+","+t/100+")",document.getElementById("paint-preview").style.backgroundColor=b.paintRGBA}function t(){document.getElementById("grid-table").innerHTML="";var e=document.getElementById("grid-size-input").value;b.gridSize=e,n(e)}function n(e){for(var t=0;t<e;t++){var n=document.createElement("TR");document.getElementById("grid-table").appendChild(n);for(var a=0;a<e;a++){var d="x"+a+"y"+t,r=document.createElement("TD");r.id=d,r.className="pixel",r.style.backgroundColor="rgba(255,255,255,1)",document.querySelector("tr:last-child").appendChild(r)}}}function a(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=b.gridSize;e.width=n,e.height=n;for(var a=t.getImageData(0,0,n,n),d=a.data,r=0;r<d.length;r+=4){var o=[],l=r/4,i=document.querySelectorAll("tr > td")[l],c=i.style.backgroundColor;c.indexOf("rgba")===-1?(c=c.replace("rgb(",""),c=c.replace(")",""),c=c.replace(/,/g,""),o=c.split(" "),o.push(1)):(c=c.replace("rgba(",""),c=c.replace(")",""),c=c.replace(/,/g,""),o=c.split(" ")),d[r]=parseInt(o[0]),d[r+1]=parseInt(o[1]),d[r+2]=parseInt(o[2]),d[r+3]=255*o[3]}a.data=d,t.putImageData(a,0,0);var u=e.toDataURL();return document.getElementById("preview-image").setAttribute("src",u),u}function d(e){var t=a();e.href=t;var n=document.getElementById("file-name-input").value;e.download=n?n:"favicon.ico"}function r(){var e=document.getElementById("grid-section").clientWidth,t=document.getElementById("grid-section").clientHeight,n=document.getElementById("grid-container");if(t<e){var a=t-.05*t+"px",d=t-.05*t+"px";n.style.height=a,n.style.width=d}else n.style.height=e-.05*e+"px",n.style.width=e-.05*e+"px"}function o(){if(this===document||"1"===document.getElementById("grid-toggle").value){document.getElementById("grid-table").style.border="1px solid black";for(var e=document.getElementsByTagName("TD"),t=0;t<e.length;t++)e[t].style.border="1px solid black";for(var n=document.getElementsByTagName("TR"),t=0;t<e.length;t++)n[t].style.border="1px solid black"}else{document.getElementById("grid-table").style.border="none";for(var e=document.getElementsByTagName("TD"),t=0;t<e.length;t++)e[t].style.border="none";for(var n=document.getElementsByTagName("TR"),t=0;t<n.length;t++)n[t].style.border="none"}}function l(){if(this===document||b.showFullMenu){var e=document.getElementById("secondary-tools"),t=document.getElementById("masking-layer");b.showFullMenu=!1,c(e,"visible"),c(t,"visible")}else{var e=document.getElementById("secondary-tools"),t=document.getElementById("masking-layer");b.showFullMenu=!0,i(e,"visible"),i(t,"visible")}}function i(e,t){var n=e.className,a=new RegExp("\\b"+t+"\\b");!n.match(a)&&(e.className=n+" "+t)}function c(e,t){var n=e.className,a=new RegExp("\\b"+t+"\\b");n.match(a)&&(e.className=n.replace(a,""))}function u(e){var t=e.srcElement,n=t.className,a=new RegExp("\\bpixel\\b");n.match(a)&&(t.style.backgroundColor=b.paintRGBA,b.drawing=!0)}function m(e){var t=e.srcElement,n=t.className,a=new RegExp("\\bpixel\\b");n.match(a)&&b.drawing&&(t.style.backgroundColor=b.paintRGBA)}function s(e){var t=document.elementFromPoint(e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY),n=t.className,a=new RegExp("\\bpixel\\b");n.match(a)&&b.drawing&&(t.style.backgroundColor=b.paintRGBA)}function g(e){var t=e.srcElement,n=t.className,d=new RegExp("\\bpixel\\b");n.match(d)&&(b.drawing=!1,a())}function p(e){return parseInt(y(e).substring(0,2),16)}function v(e){return parseInt(y(e).substring(2,4),16)}function E(e){return parseInt(y(e).substring(4,6),16)}function y(e){return"#"==e.charAt(0)?e.substring(1,7):e}var b={drawing:!1,gridSize:16,paintRGBA:"rgba(0,128,255,0.5)",showFullMenu:!1};n(b.gridSize),r(),e(),window.onresize=r,document.addEventListener("mousedown",u,!1),document.addEventListener("touchstart",u,!1),document.addEventListener("mouseover",m,!1),document.addEventListener("touchmove",s,!1),document.addEventListener("mouseup",g,!1),document.addEventListener("touchend",g,!1),document.getElementById("paint-color-input").addEventListener("change",e),document.getElementById("paint-opacity-input").addEventListener("change",e),document.getElementById("grid-toggle").addEventListener("change",o),document.getElementById("reset-grid-button").addEventListener("click",t),document.getElementById("download-button").addEventListener("click",function(){d(this)}),document.getElementById("full-menu-button").addEventListener("click",l),document.getElementById("masking-layer").addEventListener("click",l)};(document.readyState="complete")?pixelpad():document.addEventListener("DOMContentLoaded",pixelpad);