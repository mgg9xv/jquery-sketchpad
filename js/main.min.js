var pixelpad=function(){function e(){var e=document.getElementById("paint-color-input").value,t=document.getElementById("paint-opacity-input").value;b.paintRGBA="rgba("+p(e)+","+v(e)+","+y(e)+","+t/100+")",document.getElementById("paint-preview").style.backgroundColor=b.paintRGBA}function t(){document.getElementById("grid-table").innerHTML="";var e=document.getElementById("grid-size-input").value;b.gridSize=e,n(e)}function n(e){for(var t=0;t<e;t++){var n=document.createElement("TR");document.getElementById("grid-table").appendChild(n);for(var a=0;a<e;a++){var r="x"+a+"y"+t,d=document.createElement("TD");d.id=r,d.className="pixel",d.style.backgroundColor="rgba(255,255,255,1)",document.querySelector("tr:last-child").appendChild(d)}}}function a(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=b.gridSize;e.width=n,e.height=n;for(var a=t.getImageData(0,0,n,n),r=a.data,d=0;d<r.length;d+=4){var o=[],i=d/4,l=document.querySelectorAll("tr > td")[i],c=l.style.backgroundColor;c.indexOf("rgba")===-1?(c=c.replace("rgb(",""),c=c.replace(")",""),c=c.replace(/,/g,""),o=c.split(" "),o.push(1)):(c=c.replace("rgba(",""),c=c.replace(")",""),c=c.replace(/,/g,""),o=c.split(" ")),r[d]=parseInt(o[0]),r[d+1]=parseInt(o[1]),r[d+2]=parseInt(o[2]),r[d+3]=255*o[3]}a.data=r,t.putImageData(a,0,0);var u=e.toDataURL();return document.getElementById("preview-image").setAttribute("src",u),u}function r(e){var t=a();e.href=t;var n=document.getElementById("file-name-input").value;e.download=n?n:"favicon.ico"}function d(){var e=document.getElementById("grid-section").clientWidth,t=document.getElementById("grid-section").clientHeight,n=document.getElementById("grid-container");if(t<e){var a=t-.05*t+"px",r=t-.05*t+"px";n.style.height=a,n.style.width=r}else n.style.height=e-.05*e+"px",n.style.width=e-.05*e+"px"}function o(){if(this===document||"1"===document.getElementById("grid-toggle").value){document.getElementById("grid-table").style.border="1px solid black";for(var e=document.getElementsByTagName("TD"),t=0;t<e.length;t++)e[t].style.border="1px solid black";for(var n=document.getElementsByTagName("TR"),t=0;t<n.length;t++)n[t].style.border="1px solid black"}else{document.getElementById("grid-table").style.border="none";for(var e=document.getElementsByTagName("TD"),t=0;t<e.length;t++)e[t].style.border="none";for(var n=document.getElementsByTagName("TR"),t=0;t<n.length;t++)n[t].style.border="none"}}function i(){if(this===document||b.showFullMenu){var e=document.getElementById("secondary-tools"),t=document.getElementById("masking-layer");b.showFullMenu=!1,c(e,"visible"),c(t,"visible")}else{var e=document.getElementById("secondary-tools"),t=document.getElementById("masking-layer");b.showFullMenu=!0,l(e,"visible"),l(t,"visible")}}function l(e,t){var n=e.className.toString(),a=new RegExp("\\b"+t+"\\b");!n.match(a)&&(e.className=n+" "+t)}function c(e,t){var n=e.className.toString(),a=new RegExp("\\b"+t+"\\b");n.match(a)&&(e.className=n.replace(a,""))}function u(e){var t=e.srcElement,n=t.className.toString(),a=new RegExp("\\bpixel\\b");n.match(a)&&(t.style.backgroundColor=b.paintRGBA,b.drawing=!0)}function m(e){var t=e.srcElement,n=t.className.toString(),a=new RegExp("\\bpixel\\b");n.match(a)&&b.drawing&&(t.style.backgroundColor=b.paintRGBA)}function s(e){var t=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY),n=t.className.toString(),a=new RegExp("\\bpixel\\b");n.match(a)&&b.drawing&&(t.style.backgroundColor=b.paintRGBA)}function g(e){var t=e.srcElement,n=t.className.toString(),r=new RegExp("\\bpixel\\b");n.match(r)&&(b.drawing=!1,a())}function p(e){return parseInt(E(e).substring(0,2),16)}function v(e){return parseInt(E(e).substring(2,4),16)}function y(e){return parseInt(E(e).substring(4,6),16)}function E(e){return"#"==e.charAt(0)?e.substring(1,7):e}var b={drawing:!1,gridSize:16,paintRGBA:"rgba(0,128,255,0.5)",showFullMenu:!1};n(b.gridSize),d(),e(),window.onresize=d,document.addEventListener("mousedown",u,!1),document.addEventListener("touchstart",u,!1),document.addEventListener("mouseover",m,!1),document.addEventListener("touchmove",s,!1),document.addEventListener("mouseup",g,!1),document.addEventListener("touchend",g,!1),document.getElementById("paint-color-input").addEventListener("change",e),document.getElementById("paint-opacity-input").addEventListener("change",e),document.getElementById("grid-toggle").addEventListener("change",o),document.getElementById("reset-grid-button").addEventListener("click",t),document.getElementById("download-button").addEventListener("click",function(){r(this)}),document.getElementById("full-menu-button").addEventListener("click",i),document.getElementById("masking-layer").addEventListener("click",i)};(document.readyState="complete")?pixelpad():document.addEventListener("DOMContentLoaded",pixelpad);