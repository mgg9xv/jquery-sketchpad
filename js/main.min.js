$(document).ready(function(){function n(){var n=$("#paint-color-input").val(),t=$("#paint-opacity-input").val();v.paintRGBA="rgba("+u(n)+","+d(n)+","+g(n)+","+t/100+")",$("#paint-preview").css("background-color",v.paintRGBA)}function t(){var n=$("#control-section"),t=$("#grid-section");n.toggleClass("control-section-visible"),t.toggleClass("grid-section-visible")}function e(){$("#grid-table").empty();var n=$("#grid-size-input").val();v.gridSize=n,i(n)}function i(n){for(var t=0;t<n;t++){$("#grid-table").append("<tr></tr>");for(var e=0;e<n;e++){var i="x"+e+"y"+t;$("tr:last-child").append("<td id='"+i+"' class='pixel'></td>")}}}function o(){var n=document.createElement("canvas"),t=n.getContext("2d"),e=v.gridSize;n.width=e,n.height=e;for(var i=t.getImageData(0,0,e,e),o=i.data,r=0;r<o.length;r+=4){var a=[],c=r/4,s=$("tr td:eq("+c+")").css("background-color");s.indexOf("rgba")===-1?(s=s.replace("rgb(",""),s=s.replace(")",""),s=s.replace(/,/g,""),a=s.split(" "),a.push(1)):(s=s.replace("rgba(",""),s=s.replace(")",""),s=s.replace(/,/g,""),a=s.split(" ")),o[r]=parseInt(a[0]),o[r+1]=parseInt(a[1]),o[r+2]=parseInt(a[2]),o[r+3]=255*a[3]}i.data=o,t.putImageData(i,0,0);var l=n.toDataURL();return $("#preview-image").attr("src",l),l}function r(n){var t=o();n.href=t;var e=$("#file-name-input").val();n.download=e?e:"favicon.ico"}function a(){var n=$("#grid-section").width(),t=$("#grid-section").height();t<n?($("#grid-container").height(t-.05*t),$("#grid-container").width(t-.05*t)):($("#grid-container").height(n-.05*n),$("#grid-container").width(n-.05*n))}function c(){this===document||"1"===$("#grid-toggle").val()?$("table, th, td ").css("border","1px solid black"):$("table, th, td ").css("border","none")}function s(){this===document||v.showFullMenu?(v.showFullMenu=!1,$("#secondary-tools").css("display","none"),$("#mask-level").removeClass("visible")):(v.showFullMenu=!0,$("#secondary-tools").css("display","block"),$("#mask-level").addClass("visible"))}function l(){var n=$(this).val();$("#grid-size-addon").text("x"+n)}function u(n){return parseInt(p(n).substring(0,2),16)}function d(n){return parseInt(p(n).substring(2,4),16)}function g(n){return parseInt(p(n).substring(4,6),16)}function p(n){return"#"==n.charAt(0)?n.substring(1,7):n}var v={drawing:!1,gridSize:16,paintRGBA:"rgba(0,128,255,0.5)",showFullMenu:!1};i(v.gridSize),a(),n(),$(window).on("resize",a),$("#control-section-button").on("click",t),$("#paint-color-input").on("change",n),$("#paint-opacity-input").on("change",n),$("#grid-size-input").on("change",l),$("#grid-toggle").on("change",c),$("#reset-grid-button").on("click",e),$("#download-button").on("click",function(){r(this)}),$("#full-menu-button").on("click",s),$("#mask-level").on("click",s),$(document).on("mousedown touchstart",".pixel",function(n){n.preventDefault(),$(this).css("background-color",v.paintRGBA),v.drawing=!0}),$(document).on("mouseover",".pixel",function(n){n.preventDefault(),v.drawing&&$(this).css("background-color",v.paintRGBA)}),$(document).on("touchmove",".pixel",function(n){n.preventDefault();var t=document.elementFromPoint(n.originalEvent.touches[0].clientX,n.originalEvent.touches[0].clientY);$(t).hasClass("pixel")&&$(t).css("background-color",v.paintRGBA)}),$(document).on("mouseup touchend",".pixel",function(n){n.preventDefault(),v.drawing=!1,o()})});